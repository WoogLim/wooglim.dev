---
title: "[í•­í•´] í•­í•´ ì‹¬í™” ì£¼ì°¨ - 5"
description: "Sequelizeì—ì„œì˜ íŠ¸ëœì­ì…˜ ì ìš©"
language: "daliyreport"
category: "Hanghae99"
update: "2023-03-10"
serisenumber: 21
---

## Transaction

### íŠ¸ëœì­ì…˜ì˜ ì •ì˜
> íŠ¸ëœì­ì…˜(Transaction)ì€ ì‘ì—…ì˜ ì™„ì „ì„±ì„ ë³´ì¥í•´ì£¼ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ê°œë…ì…ë‹ˆë‹¤. íŠ¹ì •í•œ ì‘ì—…ì„ ì „ë¶€ ì²˜ë¦¬í•˜ê±°ë‚˜, ì „ë¶€ ì‹¤íŒ¨í•˜ê²Œ ë§Œë“¤ì–´ ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ë³´ì¥í•´ì£¼ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

> **íŠ¸ëœì­ì…˜(Transaction)**ì„ ì‚¬ìš©í•˜ëŠ” ëŒ€í‘œì ì¸ ì´ìœ ëŠ” ì‘ì—…ì˜ ë‹¨ìœ„ë¥¼ í•˜ë‚˜ì˜ ì¿¼ë¦¬ì— ì¢…ì†í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ, **ì—¬ëŸ¬ê°œì˜ ì‘ì—…(ì¿¼ë¦¬)**ì„ ë¬¶ì–´ **í•˜ë‚˜ì˜ ì‘ì—… ë‹¨ìœ„**ë¡œ **ê·¸ë£¹í™”**í•˜ì—¬ ì²˜ë¦¬í•˜ëŠ” ì‘ì—…ì„ ëœ»í•©ë‹ˆë‹¤. 
ëŒ€ë¶€ë¶„ì˜ ë°ì´í„°ë² ì´ìŠ¤ê°€ íŠ¸ëœì­ì…˜ì˜ íŠ¹ì§•ì„ ì´ìš©í•˜ê³  ìˆìœ¼ë©°, MySQLë¿ë§Œ ì•„ë‹ˆë¼ [AWS DynamoDB](https://docs.aws.amazon.com/ko_kr/amazondynamodb/latest/developerguide/transaction-apis.html), [MongoDB](https://www.mongodb.com/docs/manual/core/transactions/), [CockroachDB](https://www.cockroachlabs.com/docs/stable/transactions.html#sql-statements) ë“± ë‹¤ì–‘í•œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œë„ íŠ¸ëœì­ì…˜ì˜ ê°œë…ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ì˜ˆë¥¼ë“¤ì–´ ì€í–‰ì—ì„œ ê³„ì¢Œì´ì²´ë¥¼ í•˜ê²Œ ë  ê²½ìš° ì•„ë˜ì™€ ê°™ì€ ìƒí™©ì´ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.
1ï¸âƒ£Â  **A ê³ ê°ì˜ ê³„ì¢Œì—ì„œ 1,000ì›ì„ ì°¨ê°í•©ë‹ˆë‹¤.**  
2ï¸âƒ£Â  **B ê³ ê°ì˜ ê³„ì¢Œì— 1,000ì›ì„ ì¶”ê°€í•©ë‹ˆë‹¤.**  
ì—¬ê¸°ì„œ **1ï¸âƒ£Â ë²ˆ ì‘ì—…** ì´í›„ **2ï¸âƒ£Â ë²ˆ ì‘ì—…**ì„ ìˆ˜í–‰í•˜ë˜ ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí•˜ê²Œ ë  ê²½ìš° **A** ê³ ê°ì˜ ê³„ì¢Œì—ì„œ **1,000**ì›ë§Œ **ì°¨ê°**ë˜ê¸°ë§Œ í•˜ëŠ” ë¬¸ì œì ì´ ë°œìƒí•˜ê²Œë©ë‹ˆë‹¤. ë§Œì•½ ìˆœì„œê°€ ë°˜ëŒ€ë¡œ ë˜ì—ˆë‹¤ë©´, **B** ê³ ê°ì˜ ê³„ì¢Œì— **1,000**ì›ì´ **ì¦ê°€**ë˜ê¸°ë§Œ í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ê² ì£ ?  
ì´ëŸ° **ë¶€ë¶„ ì—…ë°ì´íŠ¸(Partial Update)**ì™€ ê°™ì€ ìƒí™©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ **íŠ¸ëœì­ì…˜(Transaction)**ì´ë¼ëŠ” ê°œë…ì„ ë„ì…í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.   
ë‹¨ìˆœíˆ ìœ„ì™€ ê°™ì€ ìƒí™© ì™¸ì—ë„ ì‘ì—…í•œ ë‚´ì—­ì„ ì €ì¥í•˜ëŠ” **ë¡œê¹…**ì‘ì—…, ì˜í™”ê´€ì˜ **ì˜ˆë§¤ ì‹œìŠ¤í…œ**, ì€í–‰ì˜ **ê²°ì œ ì‹œìŠ¤í…œ** ë“± **ë°ì´í„°ì˜ ì¼ê´€ì„±**ì„ ìœ ì§€í•´ì•¼í•˜ëŠ” ë‹¤ì–‘í•œ ìƒí™©ì—ì„œ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.

- ê²°êµ­, íŠ¸ëœì­ì…˜(Transaction)ì„ ì´ìš©í•œë‹¤ë©´ ì‚¬ìš©ìê°€ í•­ìƒ í”„ë¡œê·¸ë¨ ì‹¤í–‰ì„ ì™„ë£Œí•˜ë„ë¡ êµ¬ì„±í•˜ê³ , ë§Œì•½ ì‹¤í–‰ì„ ì¤‘ë‹¨í•  ë§Œí•œ ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë”ë¼ë„, DBì— í”¼í•´ê°€ ê°€ì§€ì•Šì•„ ë”ìš± ì•ˆì „í•˜ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

### íŠ¹ì§•(ACID)
- íŠ¸ëœì­ì…˜ì˜ íŠ¹ì§•(ACID)ì€ ë°ì´í„°ë² ì´ìŠ¤ íŠ¸ëœì­ì…˜ì´ ì•ˆì „í•˜ê²Œ ìˆ˜í–‰ëœë‹¤ëŠ” ê²ƒì„ ë³´ì¥í•˜ê¸° ìœ„í•œ íŠ¹ì§•ë“¤ì„ ë‚˜ì—´í•´ ë†“ì€ ê°œë…ì…ë‹ˆë‹¤.

ACIDëŠ” íŠ¸ëœì­ì…˜ì„ ì´ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë”ìš± ì•ˆì „í•˜ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” íŠ¸ëœì­ì…˜ íŠ¹ì§• 4ê°€ì§€ì˜ ë§¨ ì•ë‹¨ì–´ë¥¼ í•˜ë‚˜ì”© ê°€ì ¸ì™€ ë§Œë“  ê²ƒ ì…ë‹ˆë‹¤.

[ê·¸ë¦¼ - ACID]

**ACID**ëŠ” íŠ¸ëœì­ì…˜ì˜ 4ê°€ì§€ íŠ¹ì§•ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

- **ì›ìì„±(Atomicity)**
- **ì¼ê´€ì„±(Consistency)**
- **ê²©ë¦¬ì„±(Isolation)**
- **ì§€ì†ì„±(Durability)**

#### ì›ìì„±(Atomicity)
- ì›ìì„±(Atomicity)ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì‹¤í–‰ë˜ëŠ” ëª…ë ¹ë“¤ì„ í•˜ë‚˜ì˜ ë¬¶ìŒìœ¼ë¡œ ì²˜ë¦¬í•˜ì—¬, ë‚´ë¶€ì—ì„œ ì‹¤í–‰ëœ ëª…ë ¹ë“¤ì´ ì „ë¶€ ì„±ê³µí•˜ê±°ë‚˜, ì•„ë‹ˆë©´ ëª¨ë‘ ì‹¤íŒ¨í•´ì•¼í•œë‹¤ëŠ” íŠ¹ì§•ì…ë‹ˆë‹¤.

ì›ìì„±(Atomicity)ì€ íŠ¸ëœì­ì…˜ì˜ ê°€ì¥ ëŒ€í‘œì ì¸ íŠ¹ì§•ì…ë‹ˆë‹¤. íŠ¸ëœì­ì…˜ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì¿¼ë¦¬ë§ˆë‹¤ í•˜ë‚˜ì˜ ì‘ì—… ë‹¨ìœ„ë¡œ ë³´ì§€ì•Šê³ , ì—¬ëŸ¬ê°œì˜ ì‘ì—…ë“¤ì„ ë¬¶ì–´ í•˜ë‚˜ì˜ ì‘ì—…ë‹¨ìœ„ë¡œ ë³´ê²Œë©ë‹ˆë‹¤.

> ğŸ“Œ **ê³„ì¢Œì´ì²´ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**  
1. A ê³„ì¢Œì˜ ê¸ˆì•¡ì„ ì°¨ê°í•©ë‹ˆë‹¤.  
2. B ê³„ì¢Œì˜ ê¸ˆì•¡ì„ ì¦ê°€ ì‹œí‚µë‹ˆë‹¤.

íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ê²Œ ë  ê²½ìš° 2ë‹¨ê³„ë¡œ êµ¬ë¶„ëœ ë¹„ì¦ˆë‹ˆìŠ¤ë¡œì§ì„ ê³ ê°ì˜ ê³„ì¢Œ ê¸ˆì•¡ ì°¨ê°, ê¸ˆì•¡ ì¦ê°€ë¥¼ í•˜ë‚˜ì˜ ê³„ì¢Œì´ì²´ë¼ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ ë¬¶ì–´ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ ë  ê²ƒì…ë‹ˆë‹¤.

ì›ìì„±ì´ë¼ëŠ” íŠ¹ì§•ì„ ì´ìš©í•´ ì—¬ëŸ¬ë¶„ë“¤ì€ ê°ê°ì˜ ì¿¼ë¦¬ë¥¼ ë³„ë„ë¡œ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë™ì‹œì— ì‹¤í–‰í•´ì•¼í•˜ëŠ” ì—¬ëŸ¬ê°œì˜ ì¿¼ë¦¬ë¥¼ ë¬¶ì–´ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ ë  ê²ƒì´ê³ , ì—¬ëŸ¬ê°œì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìƒì„¸í•˜ê²Œ ì•Œì§€ ì•Šë”ë¼ë„ í•˜ë‚˜ì˜ í•¨ìˆ˜ì²˜ëŸ¼ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë  ê²ƒì…ë‹ˆë‹¤.

#### ì¼ê´€ì„±(Consistency)
- ì¼ê´€ì„±(Consistency)ì€ íŠ¸ëœì­ì…˜ ë‚´ë¶€ì—ì„œ ì²˜ë¦¬ë˜ëŠ” ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•´ì•¼í•˜ëŠ” íŠ¹ì§•ì…ë‹ˆë‹¤. ë§Œì•½ ì‘ì—…ì´ ì„±ê³µí•  ê²½ìš° ì•„ë¬´ëŸ° ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šê³ , ì‹¤íŒ¨í•˜ë”ë¼ë„ ì‘ì—…ì„ ì§„í–‰í•˜ë˜ ë„ì¤‘ ì‹¤íŒ¨í•œ ìƒíƒœë¡œ ë°ì´í„°ë¥¼ ë°©ì¹˜í•˜ì§€ ì•ŠëŠ” íŠ¹ì§•ì…ë‹ˆë‹¤.

ì¼ê´€ì„±(Consistency)ì˜ íŠ¹ì§•ì€ íŠ¸ëœì­ì…˜ ë‚´ì˜ ë°ì´í„°ëŠ” ì¼ê´€ë˜ì–´ì•¼í•˜ë©°, ì—ëŸ¬ê°€ ë°œìƒí•˜ë”ë¼ë„ ë°ì´í„°ì˜ ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ì•ˆëœë‹¤ëŠ” íŠ¹ì§•ì…ë‹ˆë‹¤. ë§Œì•½ ì¼ê´€ì„±ì´ ì§€ì¼œì§€ì§€ ì•Šì„ ê²½ìš° ì—¬ëŸ¬ë¶„ë“¤ì€ íŠ¸ëœì­ì…˜ì„ ì´ìš©í•˜ë”ë¼ë„ ì–¸ì œ ë°ì´í„°ê°€ íŒŒì†ë  ì§€ ëª¨ë¥´ëŠ” ë¶ˆì•ˆê°ì„ ê°€ì§„ ì²´ ì‘ì—…ì„ í•´ì•¼í•  ê²ƒ ì…ë‹ˆë‹¤.

> ğŸ“Œ **ê°•ì˜ ë“±ë¡ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ë¡œì§**
1. **ê°•ì˜(Courses)** í…Œì´ë¸”ì—ì„œ ê°•ì˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.  
2. ìƒì„±ëœ ê°•ì˜ ë°ì´í„°ë¥¼ ì°¸ì¡°í•˜ëŠ” **ê°•ì˜ ëª©ë¡(CourseUnit)** í…Œì´ë¸”ì— ê°•ì˜ ì˜ìƒì„ **ì—…ë¡œë“œ**í•©ë‹ˆë‹¤.  
3. **ê°•ì˜ ëª©ë¡(CourseUnit)** í…Œì´ë¸”ì— ëª¨ë“  ê°•ì˜ ì˜ìƒì„ ì—…ë¡œë“œ í•˜ì˜€ë‹¤ë©´ `COMMIT`

ì²«ë²ˆì§¸ ê°•ì˜ í…Œì´ë¸”ì— ê°•ì˜ë¥¼ ìƒì„±í•˜ëŠ”ê²ƒì€ ì„±ê³µí•˜ì˜€ì§€ë§Œ ë‘ë²ˆì§¸ ê°•ì˜ ëª©ë¡ í…Œì´ë¸”ì—ì„œ ëª¨ë“  ê°•ì˜ ì˜ìƒì„ ì‚½ì…í•˜ëŠ”ë° ì‹¤íŒ¨í•˜ì˜€ë‹¤ë©´, ROLLBACKì´ ì‹¤í–‰ë˜ì–´ ê°•ì˜(Courses) í…Œì´ë¸”ê³¼ ê°•ì˜ ëª©ë¡(CourseUnit) í…Œì´ë¸”ì—ëŠ” íŠ¸ëœì­ì…˜ì—ì„œ ì¡°ì‘í•œ ë°ì´í„°ê°€ ì•„ë¬´ê²ƒë„ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìƒíƒœê°€ ë  ê²ƒì…ë‹ˆë‹¤.

ì´ë ‡ê²Œ ê°•ì˜ ìì²´ê°€ ìƒì„±ë˜ì§€ ì•Šê±°ë‚˜, ëª¨ë“  ê°•ì˜ê°€ ì—…ë¡œë“œ ë˜ëŠ” ìƒí™©ì´ ë°œìƒí•˜ê²Œ ë˜ì–´ì•¼, ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë¯¿ê³  ì‘ì—…ì„ ì§„í–‰í•  ìˆ˜ ìˆê²Œ ë  ê²ƒ ì…ë‹ˆë‹¤.

#### ê²©ë¦¬ì„±(Isolation)
- ê²©ë¦¬ì„±(Isolation)ì€ íŠ¸ëœì­ì…˜ì˜ ê²½ìš° ì‹¤í–‰ ì „ì´ë‚˜ ì‹¤í–‰ í›„ì˜ ë°ì´í„°ë¥¼ ì™¸ë¶€ì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆì§€ë§Œ, íŠ¸ëœì­ì…˜ì„ ìˆ˜í–‰í•˜ëŠ” ì¤‘ê°„ ìƒíƒœë¥¼ ë³´ê±°ë‚˜ ë³€ê²½í•  ìˆ˜ ì—†ë„ë¡ êµ¬ì„±í•˜ëŠ” íŠ¹ì§•ì…ë‹ˆë‹¤.

ê²©ë¦¬ì„±(Isolation)ì˜ ê²½ìš°, MySQLì—ì„œëŠ” ì‚¬ìš©ì¤‘ì¸ DB ì˜¤ë¸Œì íŠ¸ì— ë½(Lock)ì„ ê±¸ì–´ ê²©ë¦¬ì„±ì„ êµ¬í˜„í•˜ê²Œ ë©ë‹ˆë‹¤. ì—¬ê¸°ì„œ ë½(Lock)ì„ ê±´ ìƒíƒœëŠ” DBì— ì ‘ì†í•œ ë˜ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ê°€ í•´ë‹¹í•˜ëŠ” DB ì˜¤ë¸Œì íŠ¸ë¥¼ ì½ê±°ë‚˜, ì‚¬ìš©í•  ìˆ˜ ì—†ë„ë¡ ë§Œë“ ë‹¤ëŠ” ê°œë…ì…ë‹ˆë‹¤.  
ê²©ë¦¬ì„±ì´ë€ íŠ¹ì§•ì—ì„œ ë™ì‹œì„±(Concurrency)ê³¼ ê²©ë¦¬ ìˆ˜ì¤€(Isolation Level)ë¼ëŠ” ê°œë…ì´ ë‚˜íƒ€ë‚˜ê²Œë˜ì—ˆìŠµë‹ˆë‹¤.

##### ë™ì‹œì„±(Concurrency)
- **ë™ì‹œì„±(Concurrency)**ì€ ì—¬ëŸ¬ëª…ì˜ í´ë¼ì´ì–¸íŠ¸ê°€ í•˜ë‚˜ì˜ ë°ì´í„°ë¥¼ ë™ì‹œì— ì‚¬ìš©ë° ê³µìœ  í•˜ëŠ” ê²ƒì„ ëœ»í•©ë‹ˆë‹¤.  

> ğŸ“Œ ê³„ì¢Œì´ì²´ë¥¼ í•˜ê¸° ìœ„í•´, 2ê°œì˜ ê³„ì¢Œì´ì²´ê°€ ë°œìƒí•œë‹¤ê³  ê°€ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.  
1. 1ï¸âƒ£Â  **íŠ¸ëœì­ì…˜**ì—ì„œ A ê³„ì¢Œì—ì„œ **ì²œì›ì„ ì°¨ê°**í•˜ì—¬ `10,000` â†’ `9,000`ìœ¼ë¡œ ìˆ˜ì •í•˜ì˜€ìŠµë‹ˆë‹¤.  
2. 2ï¸âƒ£Â  **íŠ¸ëœì­ì…˜**ì—ì„œ **ìˆ˜ì •ëœ ë°ì´í„°ë¥¼ ë°”íƒ•**ìœ¼ë¡œ A ê³„ì¢Œì—ì„œ **ì²œì›ì„ ì°¨ê°**í•˜ì—¬ `9,000` â†’ `8,000`ìœ¼ë¡œ ìˆ˜ì •í•˜ì˜€ìŠµë‹ˆë‹¤.  
3. 1ï¸âƒ£Â  **íŠ¸ëœì­ì…˜**ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ì—¬, íŠ¸ëœì­ì…˜ì„ `ROLLBACK`í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.  
4. 2ï¸âƒ£Â  **íŠ¸ëœì­ì…˜**ì—ì„œ íŠ¸ëœì­ì…˜ì„ `COMMIT` í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

2ï¸âƒ£Â  íŠ¸ëœì­ì…˜ì€ ìˆ˜ì • ì¤‘ì¸ 1ï¸âƒ£  íŠ¸ëœì­ì…˜ì˜ ì˜ëª»ëœ ë°ì´í„°ë¥¼ ì°¸ì¡°í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤. ì˜ëª»ëœ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ 2ï¸âƒ£Â  íŠ¸ëœì­ì…˜ì´ ë¹„ì¦ˆë‹ˆìŠ¤ë¡œì§ì„ ìˆ˜í–‰í•˜ì—¬ 9,000ì´ ë˜ì–´ì•¼í•  ê³„ì¢Œì˜ ì”ê³ ê°€ 8,000ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.

í•˜ë‚˜ì˜ ìì›ì„ ì—¬ëŸ¬ëª…ì´ ì‚¬ìš©í•˜ì—¬ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ ë™ì‹œì„± ë¬¸ì œ(Concurrency Issues)ë¼ê³  ì¹­í•˜ê²Œ ë©ë‹ˆë‹¤.

ìì›ì„ ì‚¬ìš©í•˜ëŠ” í•˜ë‚˜ì˜ í´ë¼ì´ì–¸íŠ¸ë§Œ í•´ë‹¹ ìì›ì„ ì ìœ í•  ìˆ˜ ìˆë„ë¡ í•˜ì—¬, ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì ‘ê·¼í•  ìˆ˜ ì—†ë„ë¡ ë§Œë“¤ì–´ ìì›ì„ ê³µìœ í•˜ëŠ” ì›ì¸ì„ ì œê±°í•˜ë©´ ë©ë‹ˆë‹¤. ì´ê²ƒì„ ìì› ì ê¸ˆ(Resource Locking)ë¼ê³  ë¶€ë¥´ë©°, ë½(Lock)ì´ë¼ëŠ” ê°œë…ì´ ë‚˜ì˜¤ê²Œ ëœ ê²ƒ ì…ë‹ˆë‹¤.

#### ì§€ì†ì„±(Durability)
- ì§€ì†ì„±(Durability)ì€ íŠ¸ëœì­ì…˜ì„ ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰í•˜ë©´ ìˆ˜ì •ëœ ë°ì´í„°ë¥¼ ì‹œìŠ¤í…œì— ì˜êµ¬ì ìœ¼ë¡œ ì ìš©í•˜ëŠ” íŠ¹ì§•ì…ë‹ˆë‹¤. íŠ¸ëœì­ì…˜ì˜ ì¤‘ê°„ ê²°ê³¼ê°€ ì•„ë‹ˆë¼ ì™„ì„±ëœ ê²°ê³¼ë§Œ ì €ì¥í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ì´ìƒì´ ìƒê¸°ë”ë¼ë„ ìë™ ë³µêµ¬í•  ìˆ˜ ìˆëŠ” íŠ¹ì„±ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ íŠ¸ëœì­ì…˜ì„ ì™„ë£Œí•œ ì´í›„, DBì— COMMITì„ ìš”ì²­í•˜ì˜€ì§€ë§Œ ë³€ê²½ì‚¬í•­ì´ ë°˜ì˜ë˜ê¸° ì „ì— DBê°€ ë¹„ì •ìƒ ì¢…ë£Œë  ê²½ìš°, DBê°€ ì¬ì‹œì‘ ë  ë•Œ íŠ¸ëœì­ì…˜ì˜ ë³€ê²½ ì‚¬í•­ì„ ë‹¤ì‹œ ë°˜ì˜í•˜ê²Œ ë˜ëŠ”ë°, ì´ëŸ¬í•œ íŠ¹ì§•ì„ ì§€ì†ì„±(Durability)ì´ë¼ê³  í•©ë‹ˆë‹¤.

### MySQL íŠ¸ëœì­ì…˜
MySQLì—ì„œ íŠ¸ëœì­ì…˜ì€ ì•„ë˜ì™€ ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
```sql
-- íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.
START TRANSACTION;

-- ì„±ê³µì‹œ ì‘ì—… ë‚´ì—­ì„ DBì— ë°˜ì˜í•©ë‹ˆë‹¤.
COMMIT;

-- ì‹¤íŒ¨ì‹œ START TRANSACTIONì´ ì‹¤í–‰ë˜ê¸° ì „ ìƒíƒœë¡œ ì‘ì—… ë‚´ì—­ì„ ì·¨ì†Œí•©ë‹ˆë‹¤.
ROLLBACK;
```

#### COMMITê³¼ ROLLBACK
ìš°ì„  COMMITê³¼ ROLLBACKì„ ë´…ì‹œë‹¤.
```sql
-- SPARTA í…Œì´ë¸”ì„ ìƒì„±í•©ë‹ˆë‹¤.
CREATE TABLE IF NOT EXISTS SPARTA
(
    spartaId      INT(11)      NOT NULL PRIMARY KEY AUTO_INCREMENT,
    spartaName    VARCHAR(255) NOT NULL,
    spartaAddress VARCHAR(255) NOT NULL
);

-- 1ë²ˆì§¸ íŠ¸ëœì­ì…˜ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
START TRANSACTION;

-- SPARTA í…Œì´ë¸”ì— ë”ë¯¸ ë°ì´í„° 3ê°œë¥¼ ì‚½ì…í•©ë‹ˆë‹¤.
INSERT INTO SPARTA (spartaName, spartaAddress)
VALUES ('SPARTA1', 'SEOUL'),
       ('SPARTA2', 'BUSAN'),
       ('SPARTA3', 'DAEGU');

-- 1ë²ˆì§¸ íŠ¸ëœì­ì…˜ì„ DBì— ì ìš©í•©ë‹ˆë‹¤.
COMMIT;


-- 2ë²ˆì§¸ íŠ¸ëœì­ì…˜ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
START TRANSACTION;

-- SPARTA í…Œì´ë¸”ì— ë”ë¯¸ ë°ì´í„° 3ê°œë¥¼ ì‚½ì…í•©ë‹ˆë‹¤.
INSERT INTO SPARTA (spartaName, spartaAddress)
VALUES ('SPARTA4', 'SEOUL'),
       ('SPARTA5', 'BUSAN'),
       ('SPARTA6', 'DAEGU');

-- 2ë²ˆì§¸ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•©ë‹ˆë‹¤.
ROLLBACK;
```
ì˜ˆì‹œ ì½”ë“œë¥¼ ì‹¤í–‰í•  ê²½ìš°, 2ë²ˆì§¸ íŠ¸ëœì­ì…˜ì—ì„œ ìˆ˜í–‰í•˜ëŠ” INSERT INTOê°€ ROLLBACKë˜ì—ˆê¸° ë•Œë¬¸ì— ì‹¤ì œ SPARTA í…Œì´ë¸”ì€ 6ê°œê°€ ì•„ë‹Œ, 3ê°œì˜ ë°ì´í„°ë§Œ ì‚½ì…ë˜ì–´ ìˆëŠ” ìƒíƒœë¡œ ì¡´ì¬í•˜ê²Œ ë©ë‹ˆë‹¤.

#### ë½(LOCK)
- ë½(Lock)ì€ ë™ì‹œì„±ì„ ì œì–´í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë¥¼ ì ìœ í•˜ì—¬ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì˜ ì ‘ê·¼ì„ ë§‰ì•„ ë™ì‹œì„±ê³¼ ì¼ê´€ì„±ì˜ ê· í˜•ì„ ë§ì¶”ê¸° ìœ„í•´ ì‚¬ìš©í•©ë‹ˆë‹¤.

í•˜ë‚˜ì˜ ë°ì´í„°ë¥¼ ì—¬ëŸ¬ ì‚¬ìš©ìë“¤ì´ ë™ì‹œì— ë³€ê²½í•˜ë ¤ê³  í•  ë•Œ, ë½ì´ ì¡´ì¬í•˜ì§€ ì•Šë‹¤ë©´, í•œë²ˆì— ì—¬ëŸ¬ë²ˆì˜ ìˆ˜ì •ì´ ë°œìƒí•˜ê²Œë˜ê³ , ìµœì¢… ìˆ˜ì •ëœ ê²°ê³¼ê°’ì„ ì¸ì§€í•  ìˆ˜ ì—†ê²Œ ë˜ëŠ” ìƒí™©ìœ¼ë¡œ ì¸í•´ ë°ì´í„°ë² ì´ìŠ¤ì˜ ì¼ê´€ì„±ì´ ê¹¨ì§€ê²Œ ë©ë‹ˆë‹¤. ì´ëŸ° ìƒí™©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” **ë½(Lock)**ì´ë¼ëŠ” ê¸°ëŠ¥ì„ ì§€ì›í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

`ë½(Lock)ì˜ ì¢…ë¥˜`

- **[ê³µìœ  ë½(Shared Locks) | ì½ê¸° ë½(READ Locks)](https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html#innodb-shared-exclusive-locks)**
    - ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ë°ì´í„°ë¥¼ **ì½ëŠ” ê²ƒì€ í—ˆìš©**í•˜ì§€ë§Œ, **ìˆ˜ì •í•˜ëŠ” ê²ƒì„ ê¸ˆì§€**í•©ë‹ˆë‹¤.
    - `**READ` ì „ìš© ë½**ì´ë¼ê³  ë¶ˆë¦¬ê¸°ë„ í•˜ë©°, í•´ë‹¹ ë½ì„ ì‚¬ìš©í•˜ëŠ” íŠ¸ëœì­ì…˜ì´ ëª¨ë“  ì‘ì—…ì„ ìˆ˜í–‰í•˜ì˜€ë‹¤ë©´ ê³µìœ  ë½ì€ í•´ì œë©ë‹ˆë‹¤.

- **[ë°°íƒ€ ë½(Exclusive Locks) | ì“°ê¸° ë½(WRITE Locks)](https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html#innodb-shared-exclusive-locks)**
    - ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ë°ì´í„°ë¥¼ **ì½ê±°ë‚˜, ìˆ˜ì •í•˜ëŠ” ê²ƒì„ ê¸ˆì§€**í•©ë‹ˆë‹¤.
    - `**WRITE` ì „ìš© ë½**ì´ë¼ê³  ë¶ˆë¦¬ë©°, íŠ¸ëœì­ì…˜ì´ í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë¥¼ ì ìœ í•œ í›„ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ í•´ë‹¹ ë°ì´í„°ì— **ì ‘ê·¼ í•  ìˆ˜ ì—†ë„ë¡** ë§Œë“­ë‹ˆë‹¤.

`ë½í‚¹ ìˆ˜ì¤€(Locking Level)`

- **[ê¸€ë¡œë²Œ ë½(Global Locks) | ë°ì´í„°ë² ì´ìŠ¤ ë½(Database Locks)](https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html)**
    - **ë°ì´í„°ë² ì´ìŠ¤ì˜ ëª¨ë“  í…Œì´ë¸”ì— ë½**ì„ ê±¸ì–´, í˜„ì¬ íŠ¸ëœì­ì…˜ì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ íŠ¸ëœì­ì…˜ë“¤ì´ ëª¨ë“  í…Œì´ë¸”ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë„ë¡ ë§Œë“­ë‹ˆë‹¤.
    - **ê°€ì¥ ë†’ì€ ìˆ˜ì¤€ì˜ ë½**ì„ ê°€ì§€ê³  ìˆìœ¼ë©°, **ê°€ì¥ í° ë²”ìœ„**ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

- **[í…Œì´ë¸” ë½(Table Locks)](https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html)**
    - ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì‘ì—…ì¤‘ì¸ **í…Œì´ë¸”**ì„ ë™ì‹œì— ìˆ˜ì •í•˜ì§€ ëª»í•˜ë„ë¡ í•©ë‹ˆë‹¤.

- **[ë„¤ì„ë“œ ë½(Named Locks)](https://dev.mysql.com/doc/refman/8.0/en/locking-functions.html)**
    - í…Œì´ë¸”ì´ë‚˜ í…Œì´ë¸”ì˜ í–‰ê³¼ê°™ì€ DB ì˜¤ë¸Œì íŠ¸ê°€ ì•„ë‹Œ, **íŠ¹ì •í•œ ë¬¸ìì—´**ì„ **ì ìœ **í•©ë‹ˆë‹¤.

- **[ë©”íƒ€ë°ì´í„° ë½(Metadata Locks)](https://dev.mysql.com/doc/refman/8.0/en/metadata-locking.html)**
    - ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì‘ì—…ì¤‘ì¸ í…Œì´ë¸”ì˜ **ë™ì¼í•œ í–‰ ë° ë™ì¼í•œ ë°ì´í„°ë² ì´ìŠ¤ì˜ ê°ì²´**ë¥¼ ë™ì‹œì— ìˆ˜ì •í•˜ì§€ ëª»í•˜ë„ë¡ í•©ë‹ˆë‹¤.

> ë½ì€ ë‹¤ì–‘í•œ ë½í‚¹ ìˆ˜ì¤€(Locking Level)ì„ ê°€ì§€ê³  ìˆëŠ”ë°, ì˜ëª»ëœ ë½ ì„¤ì •ì„ í•˜ê²Œ ë  ê²½ìš° ëª¨ë“  APIê°€ ë™ì‘í•˜ì§€ ì•ŠëŠ” êµì°© ìƒíƒœ(Dead Lock)ê°€ ë°œìƒí•˜ê²Œ ë˜ì–´, í”„ë¡œê·¸ë¨ì´ ë©ˆì¶°ë²„ë¦¬ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ê²Œ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`êµì°© ìƒíƒœ(Dead Lock)`

> â“Â êµì°© ìƒíƒœ(Dead Lock)ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„  ì–´ë–»ê²Œ êµ¬ì„±í•´ì•¼í• ê¹Œìš”?  
êµì°© ìƒíƒœ(Dead Lock)ëŠ” ì—¬ëŸ¬ í…Œì´ë¸”ì— ë½(Lock)ì„ ì ìš©í•˜ì—¬, ë‹¤ë¥¸ ì‘ì—…ì´ ì²˜ë¦¬ë˜ì§€ ëª»í•˜ê²Œ ì ìœ í•˜ê³  ìˆëŠ” ì‘ì—…ì´ ìˆì„ ë•Œ, ë‹¤ë¥¸ ì‘ì—…ì„ ëë‚˜ëŠ” ê²ƒì„ ë¬´í•œì • ê¸°ë‹¤ë¦¬ëŠ”ê²ƒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

[ê·¸ë¦¼ - êµì°© ìƒíƒœ]

> ğŸ’¡ **êµì°© ìƒíƒœ**ì˜ ê²½ìš° ì•„ë˜ì™€ ê°™ì€ 2ê°œì˜ íŠ¸ëœì­ì…˜ì´ ë™ì‹œì— ì‹¤í–‰ëœë‹¤ê³  ê°€ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.  
 1ï¸âƒ£Â  Aâ†’ B í…Œì´ë¸”ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” íŠ¸ëœì­ì…˜  
 2ï¸âƒ£Â  Bâ†’ A í…Œì´ë¸”ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” íŠ¸ëœì­ì…˜

1ï¸âƒ£Â  ì€ ì²˜ìŒ **A í…Œì´ë¸”**ì„ ì ìœ í•˜ê¸° ìœ„í•´ **ë½**ì„ ê±¸ì–´ë†“ì„ ê²ƒ ì…ë‹ˆë‹¤. ê·¸ë¦¬ê³  ë™ì‹œì— 2ï¸âƒ£Â  ë˜í•œ **B í…Œì´ë¸”**ì„ ì ìœ í•˜ê¸° ìœ„í•´ **ë½**ì„ ê±¸ì–´ë†“ì„ ê²ƒ ì…ë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ 1ï¸âƒ£Â ì€ **B í…Œì´ë¸”**ì˜ ë½ì´ í’€ë¦¬ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœê°€ ë°œìƒí•˜ê²Œ ë  ê²ƒì´ê³ , 2ï¸âƒ£Â  ë˜í•œ **A í…Œì´ë¸”**ì˜ ë½ì´ í’€ë¦¬ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœê°€ ë°œìƒí•˜ê²Œ ë  ê²ƒ ì…ë‹ˆë‹¤. ì´ì²˜ëŸ¼ ë¦¬ì†ŒìŠ¤ë¥¼ ì ‘ê·¼í•˜ë ¤ê³  í•  ë•Œ, ì„œë¡œê°€ ì„œë¡œì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ì ìœ í•˜ê³  ìˆì„ ë•Œ ë°œìƒí•˜ëŠ” ê²ƒì„ **êµì°© ìƒíƒœ(Dead Lock)**ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

í•´ë‹¹í•˜ëŠ” ìƒí™©ì„ í•´ê²°í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ë¶„ë“¤ì€ íŠ¸ëœì­ì…˜ì—ì„œ ì‚¬ìš©í•˜ëŠ” **ë½(Lock)**ì˜ ìˆ˜ì¤€ì„ ëª…í™•í•˜ê²Œ ì´í•´í•˜ê³ , ì ì¬ì ì†Œì— í•„ìš”í•œ ë½ì˜ ìˆ˜ì¤€ì„ ì„¤ì •í•˜ì—¬ íŠ¸ëœì­ì…˜ì„ êµ¬ì„±í•´ì•¼í•©ë‹ˆë‹¤.

`íŠ¸ëœì­ì…˜ì˜ ê²©ë¦¬ ìˆ˜ì¤€ (Isolation Level)`
- íŠ¸ëœì­ì…˜ì˜ ê²©ë¦¬ ìˆ˜ì¤€ (Isolation Level)ì€ ì—¬ëŸ¬ íŠ¸ëœì­ì…˜ì´ ë™ì‹œì— ì²˜ë¦¬ë  ë•Œ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ë³€ê²½ ë° ì¡°íšŒí•˜ëŠ” ë°ì´í„°ë¥¼ ì½ì„ ìˆ˜ ìˆë„ë¡ í—ˆìš©í•˜ê±°ë‚˜ ê±°ë¶€í•˜ëŠ” ê²ƒì„ ê²°ì •í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ê²ƒ ì…ë‹ˆë‹¤.  

íŠ¸ëœì­ì…˜ì˜ ê²©ë¦¬ ìˆ˜ì¤€ì€ ëŒ€í‘œì ìœ¼ë¡œ 4ê°€ì§€ë¡œ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

**`READ UNCOMMITTED`**

- **ì»¤ë°‹ ë˜ì§€ ì•Šì€ ì½ê¸°(Uncommitted Read)**ë¥¼ í—ˆìš©í•˜ëŠ” ê²©ë¦¬ ìˆ˜ì¤€ì…ë‹ˆë‹¤.
- ê°€ì¥ ë‚®ì€ ìˆ˜ì¤€ì˜ ê²©ë¦¬ìˆ˜ì¤€ì´ë©°, ë½ì„ ê±¸ì§€ ì•Šì•„ ë™ì‹œì„±ì´ ë†’ì§€ë§Œ ì¼ê´€ì„±ì´ ì‰½ê²Œ ê¹¨ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**`READ COMMITTED`**

- **ì»¤ë°‹ ëœ ì½ê¸°(Committed Read)**ë§Œì„ í—ˆìš©í•˜ê³ , `SELECT` ë¬¸ì„ ì‹¤í–‰í•  ë•Œ ê³µìœ ë½ì„ ê²ë‹ˆë‹¤.
- ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ë°ì´í„°ë¥¼ **ìˆ˜ì •í•˜ê³  ìˆëŠ” ì¤‘**ì—ëŠ” **ë°ì´í„°ë¥¼ ì½ì„ ìˆ˜ ì—†ì–´** ì»¤ë°‹ë˜ì§€ ì•Šì€ ì½ê¸°í˜„ìƒì´ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

**`REPEATABLE READ`**

- ì½ê¸°ë¥¼ ë§ˆì¹˜ë”ë¼ë„ **ê³µìœ ë½**ì„ **í’€ì§€ ì•Šìœ¼ë©°**, íŠ¸ëœì­ì…˜ì´ **ì™„ì „íˆ ì¢…ë£Œë  ë•Œ ê¹Œì§€ ë½ì„ ìœ ì§€**í•©ë‹ˆë‹¤.
- ê³µìœ ë½ì´ ê±¸ë¦° ìƒíƒœì—ì„œ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•˜ì§€ë§Œ, ë°ì´í„°ë¥¼ ì‚½ì…í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤. ê·¸ë¡œì¸í•´ **íŒ¬í…€ ì½ê¸°**ê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¬¸ì œì ì´ ìˆìŠµë‹ˆë‹¤.

**`SERIALIZABLE`**

- ë°ì´í„°ë¥¼ ì½ëŠ” ë™ì•ˆ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ í•´ë‹¹ ë°ì´í„°ë¥¼ ì½ê±°ë‚˜ ì‚½ì…í•  ìˆ˜ ì—†ê³ , ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒ ë˜í•œ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
- **ê°€ì¥ ë†’ì€ ìˆ˜ì¤€ì˜ ê²©ë¦¬ ìˆ˜ì¤€**ì´ë¯€ë¡œ, ë™ì‹œì„±ì´ ë–¨ì–´ì§€ëŠ” ë¬¸ì œì ì´ ì¡´ì¬í•©ë‹ˆë‹¤.

> ğŸ’¡ **ì»¤ë°‹ë˜ì§€ ì•Šì€ ì½ê¸°(Uncommitted Read)** 
**ì»¤ë°‹ë˜ì§€ ì•Šì€ ì½ê¸°(Uncommitted Read)**ëŠ” ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì— ì˜í•´ ì‘ì—…ì¤‘ì¸ ë°ì´í„°ë¥¼ ì½ê²Œ ë˜ëŠ” ê²ƒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ë§Œì•½ ì»¤ë°‹ë˜ì§€ ì•Šì€ ì½ê¸°ê°€ ë°œìƒí•  ê²½ìš°, **ì˜ë„ì¹˜ ì•Šì€ ë°ì´í„°ë¥¼ ì°¸ì¡°**í•˜ê²Œ ë˜ì–´ ë°ì´í„°ì˜ ì¼ê´€ì„±ì´ ê¹¨ì§€ê²Œ ë˜ëŠ” ìƒí™©ì´ ë°œìƒí•˜ê²Œë©ë‹ˆë‹¤.


> ğŸ’¡ **íŒ¬í…€ ì½ê¸°(Phantom Read)** 
íŠ¸ëœì­ì…˜ì„ ìˆ˜í–‰í•˜ë˜ ì¤‘ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì— ì˜í•´ ì‚­ì œëœ ë°ì´í„°ë¥¼ íŒ¬í…€í–‰(Phantom Rows)ì´ë¼ê³  í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ, íŒ¬í…€í–‰ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë¥¼ ì½ëŠ” ê²ƒì„ íŒ¬í…€ ì½ê¸°(Phantom Read)ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

### Sequelizeì˜ íŠ¸ëœì­ì…˜
- Sequelizeì˜ íŠ¸ëœì­ì…˜ì€ COMMIT, ROLLBACKì„ ìˆ˜ë™ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ íŠ¸ëœì­ì…˜ì„ ê´€ë¦¬í•˜ëŠ” UnManaged íŠ¸ëœì­ì…˜ê³¼ Sequelizeê°€ ìì²´ì ìœ¼ë¡œ íŠ¸ëœì­ì…˜ì˜ ì„±ê³µê³¼ ì‹¤íŒ¨ë¥¼ ê´€ë¦¬í•˜ëŠ” Managed íŠ¸ëœì­ì…˜ì´ ì¡´ì¬í•©ë‹ˆë‹¤.

#### Managed íŠ¸ëœì­ì…˜
```js
const { sequelize } = require("../models/index.js");

// ì½œë°±ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ í• ë‹¹í•˜ì—¬ ë¹„ì¦ˆë‹ˆìŠ¤ë¡œì§ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
const result = await sequelize.transaction( async(t) => {
  // ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ROLLBACK
  const user = await User.create({
    firstName: 'ìš©ìš°',
    lastName: 'ì´',
  }, { transaction: t }); // í•´ë‹¹ ì¿¼ë¦¬ì— íŠ¸ëœì­ì…˜ì„ ì ìš©í•©ë‹ˆë‹¤.

  return user;
});
```
Managed íŠ¸ëœì­ì…˜ì€ ëª¨ë“  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì„±ê³µí•˜ê±°ë‚˜ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš° Sequelize ìì²´ì ìœ¼ë¡œ COMMITê³¼ ROLLBACKì„ í•˜ëŠ” ì¥ì ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

#### UnManaged íŠ¸ëœì­ì…˜
```js
const { sequelize } = require("../models/index.js");

// Sequelizeì˜ íŠ¸ëœì­ì…˜ì„ ë³€ìˆ˜ì— í• ë‹¹í•˜ì—¬ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.
const t = await sequelize.transaction();

try {
  const user = await User.create({
    firstName: 'ìš©ìš°',
    lastName: 'ì´',
  }, { transaction: t }); // í•´ë‹¹ ì¿¼ë¦¬ì— íŠ¸ëœì­ì…˜ì„ ì ìš©í•©ë‹ˆë‹¤.

  // ë¶„ê¸°ë§ˆë‹¤ COMMIT, ROLLBACKì´ ê°€ëŠ¥í•˜ë‹¤.

  // íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•œ ëª¨ë“  ë¡œì§ì„ Commit, DBì— ë°˜ì˜í•©ë‹ˆë‹¤.
  await t.commit();
} catch(transactionError) {
  // ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ë‹¤ë©´, íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•œ ëª¨ë“  ì¿¼ë¦¬ë¥¼ Rollback, DBì— ë°˜ì˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  await t.rollback();
}
```
UnManaged íŠ¸ëœì­ì…˜ì˜ ê²½ìš° ëª…ì‹œì ìœ¼ë¡œ íŠ¸ëœì­ì…˜ì„ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì—, íŠ¸ëœì­ì…˜ì˜ ê´€ë¦¬í˜„í™©ì„ ëª…í™•í•˜ê²Œ ì•Œ ìˆ˜ ìˆê³ , ì›í•˜ëŠ” ë¶„ê¸°ì²˜ë¦¬ë¥¼ ê°„ë‹¨í•˜ê²Œ êµ¬ë¶„í•  ìˆ˜ ìˆì–´ ë¹„ì¦ˆë‹ˆìŠ¤ë¡œì§ì„ ìˆëŠ” ê·¸ëŒ€ë¡œ ì½”ë“œë¡œ ë‚˜íƒ€ë‚´ê¸° ì‰½ìŠµë‹ˆë‹¤.  
COMMITê³¼ ROLLBACKì„ ì‹¤í–‰í•´ì•¼ë§Œ íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### íŠ¸ëœì­ì…˜ êµ¬í˜„

#### íšŒì›ê°€ì… íŠ¸ëœì­ì…˜
> ğŸ’¡ **[ê²Œì‹œíŒ í”„ë¡œì íŠ¸] íšŒì›ê°€ì… API ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**  
1. `email`, `password`, `name`, `age`, `gender`, `profileImage`ë¥¼ **body**ë¡œ ì „ë‹¬ë°›ìŠµë‹ˆë‹¤.
2. ë™ì¼í•œ `email`ì„ ê°€ì§„ ì‚¬ìš©ìê°€ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
3. **Users** í…Œì´ë¸”ì— `email`, `password`ë¥¼ ì´ìš©í•´ ì‚¬ìš©ìë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
4. **UserInfos** í…Œì´ë¸”ì— `name`, `age`, `gender`, `profileImage`ë¥¼ ì´ìš©í•´ ì‚¬ìš©ì ì •ë³´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
5. íšŒì›ê°€ì…ì„ ì™„ë£Œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

ì—¬ê¸°ì„œ 3ï¸âƒ£Â  ì‚¬ìš©ì ë° 4ï¸âƒ£Â  ì‚¬ìš©ì ì •ë³´ë¥¼ ìƒì„±í•˜ëŠ” ë¡œì§ì—ì„œ, ì—ëŸ¬ê°€ ë°œìƒí•˜ê²Œ ë  ê²½ìš° ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹í•˜ëŠ” ë¡œì§ì„ ë³„ë„ë¡œ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ, íŠ¸ëœì­ì…˜ì„ ì´ìš©í•´ í•˜ë‚˜ì˜ ì‘ì—… ë‹¨ìœ„ë¡œ ìˆ˜ì •í•˜ì—¬, ë¹„ì¦ˆë‹ˆìŠ¤ë¡œì§ì„ ì•ˆì „í•˜ê²Œ êµ¬í˜„í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```js
// íšŒì›ê°€ì… API
router.post('/users', async (req, res) => {
  const { email, password, name, age, gender, profileIamge } = req.body;

  // 1. ë™ì¼í•œ ì´ìš©ìê°€ ìˆëŠ”ì§€ í™•ì¸
  const isExistUser = await Users.findOne({
    where: {
      email,
    },
  });

  // emailê³¼ ë™ì¼ ìœ ì €ê°€ ìˆëŠ” ê²½ìš° ì—ëŸ¬
  if (isExistUser) {
    return res.status(409).json({
      message: 'ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤.',
    });
  }

  // 1. íŠ¸ëœì­ì…˜ ê°ì²´ë¥¼ í• ë‹¹ Modelsì— ìˆëŠ” index.jsì—ì„œ ê°€ì ¸ì˜´.
  const t = await sequelize.transaction({
    // ê²©ë¦¬ ìˆ˜ì¤€ ì„¤ì •
    isolationLevel: Transaction.ISOLATION_LEVELS.READ_COMMITTED,
  });

  try {
    // ì‚¬ìš©ì í…Œì´ë¸”ì— ë°ì´í„° ì‚½ì…
    const user = await Users.create(
      { email, password },
      { transaction: t } // íŠ¸ëœì­ì…˜ í• ë‹¹
    );

    // ì‚¬ìš©ì ì •ë³´ í…Œì´ë¸”ì— ë°ì´í„° ì‚½ì…
    // ì–´ë–¤ ì‚¬ìš©ìì˜ ì •ë³´ì¸ì§€ ë‚´ìš©ì´ í•„ìš”
    await UserInfos.create(
      {
        UserId: user.userId, // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ê°€ 24ë²ˆì§¸ ì¤„ì—ì„œ ìƒì„±ëœ ì‚¬ìš©ìì˜ userIdë¥¼ í• ë‹¹
        name,
        age,
        gender,
        profileIamge,
      },
      { transaction: t } // íŠ¸ëœì­ì…˜ í• ë‹¹
    );

    // ëª¨ë“  ë¡œì§ì´ ì™„ë£Œëœ ê²½ìš°
    await t.commit();
  } catch (transactionError) {
    // íŠ¸ëœì­ì…˜ ë‚´ ì‘ì—… ì‹¤íŒ¨í•œ ê²½ìš°
    await t.rollback();
    return res.status(400).json({ errorMessage: 'ìœ ì € ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' });
  }

  return res.status(201).json({ message: 'íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.' });
});
```
ì´í›„ ì„œë²„ ë¡œê·¸ë¥¼ ë³´ì‹œë©´ ì•„ë˜ì™€ ê°™ì´ í‘œì‹œë©ë‹ˆë‹¤.
```log
Executing (b839f436-3f3c-4c08-a633-a852b55f82c1): SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
Executing (b839f436-3f3c-4c08-a633-a852b55f82c1): START TRANSACTION;
Executing (b839f436-3f3c-4c08-a633-a852b55f82c1): INSERT INTO `Users` (`userId`,`email`,`password`,`createdAt`,`updatedAt`) VALUES (DEFAULT,?,?,?,?);
Executing (b839f436-3f3c-4c08-a633-a852b55f82c1): INSERT INTO `UserInfos` (`userInfoId`,`UserId`,`name`,`age`,`gender`,`createdAt`,`updatedAt`) VALUES (DEFAULT,?,?,?,?,?,?);
Executing (b839f436-3f3c-4c08-a633-a852b55f82c1): COMMIT;
```

ë„ì¤‘ì— ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš° ì•„ë˜ì™€ ê°™ì´ í‘œì‹œë©ë‹ˆë‹¤.
```log
Executing (649f8232-6820-4cc2-b726-42842f22d79a): SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
Executing (649f8232-6820-4cc2-b726-42842f22d79a): START TRANSACTION;
Executing (649f8232-6820-4cc2-b726-42842f22d79a): INSERT INTO `Users` (`userId`,`email`,`password`,`createdAt`,`updatedAt`) VALUES (DEFAULT,?,?,?,?);
Executing (649f8232-6820-4cc2-b726-42842f22d79a): ROLLBACK;
```

> Sequelizeì˜ ê²©ë¦¬ìˆ˜ì¤€ì€ íŠ¸ëœì­ì…˜ì„ ìƒì„±í•  ë•Œ, isolationLevel í”„ë¡œí¼í‹°ë¥¼ ì •ì˜í•¨ìœ¼ë¡œì¨ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```js
const { Transaction } = require("sequelize");

const t = await sequelize.transaction({
  isolationLevel: Transaction.ISOLATION_LEVELS.READ_COMMITTED, // íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€ì„ ì„¤ì •í•©ë‹ˆë‹¤.
});
```
ê²©ë¦¬ ìˆ˜ì¤€(Isolation Level)ì„ ì„¤ì •í•  ë•Œ, í˜„ì¬ êµ¬í˜„í•˜ë ¤ëŠ” APIì—ëŠ” ì–´ë– í•œ ê²©ë¦¬ ìˆ˜ì¤€ì´ í•„ìš”í•œì§€ ëª…í™•í•˜ê²Œ ì´í•´í•˜ì—¬ì•¼ íš¨ìœ¨ì ì¸ ë°ì´í„°ë² ì´ìŠ¤ì˜ ì„¤ê³„ë¥¼ í•  ìˆ˜ ìˆê³ , ë°ì´í„°ì˜ ì¼ê´€ì„±ì´ ê¹¨ì§€ì§€ ì•Šë„ë¡ êµ¬í˜„í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

#### ì‚¬ìš©ì ì •ë³´ ìˆ˜ì • API êµ¬í˜„

ì‚¬ìš©ì ì´ë¦„ ë³€ê²½ APIì˜ ê²½ìš° ê²°ì œì‹œìŠ¤í…œê³¼ ê°™ì´ ë†’ì€ ìˆ˜ì¤€ì˜ ì¼ê´€ì„±ì„ ìš”êµ¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, READ_COMMITTED ê²©ë¦¬ ìˆ˜ì¤€ì„ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

##### ì‚¬ì „ ì¤€ë¹„
[ê·¸ë¦¼ - userHistory]

ìƒˆë¡­ê²Œ **ì‚¬ìš©ì íˆìŠ¤í† ë¦¬(UserHisotires)** í…Œì´ë¸”ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. 

ì‚¬ìš©ìì˜ ì´ë¦„ì„ ë³€ê²½í•˜ëŠ” APIë¥¼ êµ¬í˜„í•˜ë©´ì„œ, ë³€ê²½ëœ ì‚¬ìš©ì ì´ë¦„ ì •ë³´ë¥¼ **ë¡œê¹…(Logging)**í•˜ê¸° ìœ„í•´ **ì‚¬ìš©ì íˆìŠ¤í† ë¦¬ í…Œì´ë¸”**ì— ë°ì´í„°ë¥¼ ê°™ì´ ìƒì„±í•˜ë„ë¡ êµ¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤.

`migration`íŒŒì¼ì€ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•©ë‹ˆë‹¤. `createdAt, UpdatedAt`ì´ ì—†ìœ¼ë©°, ì™¸ë˜í‚¤ì¸ `userHistoyId`ëŠ” íƒ€ì…ì´ `Sequelize.UUID`ë¡œ ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ê°’ì€ `Sequelize.UUIDV4`ì…ë‹ˆë‹¤. UUIDì˜ ìµœëŒ“ê°’ìœ¼ë¡œ íƒ€ì…ì„ ì§€ì •í•˜ëŠ” ê²ë‹ˆë‹¤.
```js
await queryInterface.createTable('UserHistories', {
      userHistoryId: {
        allowNull: false, // NOT NULL
        primaryKey: true, // Primary Key (ê¸°ë³¸í‚¤)
        type: Sequelize.UUID, // UUIDì˜ ìµœëŒ“ê°’ìœ¼ë¡œ íƒ€ì…ì„ ì§€ì •í•©ë‹ˆë‹¤.
        defaultValue: Sequelize.UUIDV4, // UUIDë¥¼ ê¸°ë³¸ ê°’ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
      },
      UserId: {
        allowNull: false, // NOT NULL
        type: Sequelize.INTEGER,
        references: {
          model: 'Users', // Users ëª¨ë¸ì„ ì°¸ì¡°í•©ë‹ˆë‹¤.
          key: 'userId', // Users ëª¨ë¸ì˜ userIdë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤.
        },
        onDelete: 'CASCADE', // ë§Œì•½ Users ëª¨ë¸ì˜ userIdê°€ ì‚­ì œë˜ë©´, UserHistories ëª¨ë¸ì˜ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.
      },
      beforeName: {
        allowNull: false, // NOT NULL
        type: Sequelize.STRING,
      },
      afterName: {
        allowNull: false, // NOT NULL
        type: Sequelize.STRING,
      }
    });
  },
```

modelì€ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•©ë‹ˆë‹¤.
```js
// userhistories.js
'use strict';
const { Model } = require('sequelize');
const Sequelize = require('sequelize');
module.exports = (sequelize, DataTypes) => {
  class UserHistories extends Model {
    /**
     * Helper method for defining associations.
     * This method is not a part of Sequelize lifecycle.
     * The `models/index` file will call this method automatically.
     */
    static associate(models) {
      // define association here

      // 1. UserHistories ëª¨ë¸ì—ì„œ
      this.belongsTo(models.Users, { // 2. Users ëª¨ë¸ì—ê²Œ N:1 ê´€ê³„ ì„¤ì •ì„ í•©ë‹ˆë‹¤.
        targetKey: 'userId', // 3. Users ëª¨ë¸ì˜ userId ì»¬ëŸ¼ì„
        foreignKey: 'UserId', // 4. UserHistories ëª¨ë¸ì˜ UserId ì»¬ëŸ¼ê³¼ ì—°ê²°í•©ë‹ˆë‹¤.
      });
    }
  }

  UserHistories.init(
    {
      userHistoryId: {
        allowNull: false, // NOT NULL
        primaryKey: true, // Primary Key (ê¸°ë³¸í‚¤)
        type: Sequelize.UUID, // UUIDì˜ ìµœëŒ“ê°’ìœ¼ë¡œ íƒ€ì…ì„ ì§€ì •í•©ë‹ˆë‹¤.
        defaultValue: Sequelize.UUIDV4, // UUIDë¥¼ ê¸°ë³¸ ê°’ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
      },
      UserId: {
        allowNull: false, // NOT NULL
        type: DataTypes.INTEGER,
        references: {
          model: 'Users', // Users ëª¨ë¸ì„ ì°¸ì¡°í•©ë‹ˆë‹¤.
          key: 'userId', // Users ëª¨ë¸ì˜ userIdë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤.
        },
        onDelete: 'CASCADE', // ë§Œì•½ Users ëª¨ë¸ì˜ userIdê°€ ì‚­ì œë˜ë©´, Comments ëª¨ë¸ì˜ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.
      },
      beforeName: {
        allowNull: false, // NOT NULL
        type: DataTypes.STRING,
      },
      afterName: {
        allowNull: false, // NOT NULL
        type: DataTypes.STRING,
      }
    },
    {
      sequelize,
      modelName: 'UserHistories',
      timestamps: false, // createdAt, updatedAt ì»¬ëŸ¼ì„ ìƒì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    }
  );
  return UserHistories;
};
```

sqlì€ ë‹¤ìŒê³¼ ê°™ì£ .
```sql
CREATE TABLE Users
(
    userId    int(11)             NOT NULL AUTO_INCREMENT PRIMARY KEY,
    email     varchar(255) UNIQUE NOT NULL,
    password  varchar(255)        NOT NULL,
    createdAt datetime            NOT NULL DEFAULT NOW(),
    updatedAt datetime            NOT NULL DEFAULT NOW()
);


CREATE TABLE UserInfos
(
    userInfoId   int(11)        NOT NULL AUTO_INCREMENT PRIMARY KEY,
    UserId       int(11) UNIQUE NOT NULL, -- 1:1 ê´€ê³„ ì´ë¯€ë¡œ UNIQUE ì¡°ê±´ì„ ì‚½ì…í•©ë‹ˆë‹¤.
    name         varchar(255)   NOT NULL,
    age          int(11)        NOT NULL,
    gender       varchar(255)   NOT NULL,
    profileImage varchar(255)   NULL,
    createdAt    datetime       NOT NULL DEFAULT NOW(),
    updatedAt    datetime       NOT NULL DEFAULT NOW()
);

ALTER TABLE UserInfos
    ADD CONSTRAINT FK_UserInfos_Users
        FOREIGN KEY (UserId) REFERENCES Users (userId) ON DELETE CASCADE;


CREATE TABLE Posts
(
    postId    int(11)      NOT NULL AUTO_INCREMENT PRIMARY KEY,
    UserId    int(11)      NOT NULL,
    title     varchar(255) NOT NULL,
    content   varchar(255) NOT NULL,
    createdAt datetime     NOT NULL DEFAULT NOW(),
    updatedAt datetime     NOT NULL DEFAULT NOW()
);

ALTER TABLE Posts
    ADD CONSTRAINT FK_Posts_Users
        FOREIGN KEY (UserId) REFERENCES Users (userId) ON DELETE CASCADE;


CREATE TABLE Comments
(
    commentId int(11)      NOT NULL AUTO_INCREMENT PRIMARY KEY,
    UserId    int(11)      NOT NULL,
    PostId    int(11)      NOT NULL,
    comment   varchar(255) NOT NULL,
    createdAt datetime     NOT NULL DEFAULT NOW(),
    updatedAt datetime     NOT NULL DEFAULT NOW()
);

ALTER TABLE Comments
    ADD CONSTRAINT FK_Comments_Posts
        FOREIGN KEY (PostId) REFERENCES Posts (postId) ON DELETE CASCADE;

ALTER TABLE Comments
    ADD CONSTRAINT FK_Comments_Users
        FOREIGN KEY (UserId) REFERENCES Users (userId) ON DELETE CASCADE;


CREATE TABLE UserHistories
(
    userHistoryId VARCHAR(36)  NOT NULL DEFAULT (UUID()) PRIMARY KEY,
    UserId        int(11)      NOT NULL,
    beforeName    varchar(255) NOT NULL,
    afterName     varchar(255) NOT NULL
);

ALTER TABLE UserHistories
    ADD CONSTRAINT FK_UserHistories_Users
        FOREIGN KEY (UserId) REFERENCES Users (userId) ON DELETE CASCADE;
```

##### UUID
- UUID(ë²”ìš© ê³ ìœ  ì‹ë³„ì)ë€ ë¬´ì—‡ì¼ê¹Œìš”?

> UUID(ë²”ìš© ê³ ìœ  ì‹ë³„ì)ë€ ë¬´ì—‡ì¼ê¹Œìš”?  
ğŸ’¡ **[UUID(Universally Unique Identifier, ë²”ìš© ê³ ìœ  ì‹ë³„ì)](https://ko.wikipedia.org/wiki/%EB%B2%94%EC%9A%A9_%EA%B3%A0%EC%9C%A0_%EC%8B%9D%EB%B3%84%EC%9E%90)**ëŠ” ì´ 4ê°œì˜ ì •ë³´ë¥¼ **í•˜ì´í”ˆ(`-`)** ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ìˆœì°¨ì ìœ¼ë¡œ ì €ì¥í•œ ë°ì´í„° íƒ€ì…ì…ë‹ˆë‹¤. **ì‹œê°„ ì •ë³´ë¥¼ í¬í•¨**í•˜ê³  ìˆì–´ **ìƒì„±ëœ ìˆœì„œëŒ€ë¡œ ì •ë ¬**ì´ ë˜ëŠ” íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. mongoDBì˜ ObjectIdì™€ ìœ ì‚¬í•˜ë‹¤ê³  ìƒê°í•˜ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.
**[â†’ UUID ë””ì½”ë“œ ì‚¬ìš©í•´ë³´ê¸°](https://www.uuidtools.com/decode)**

[ê·¸ë¦¼ - UUID]

**ì‚¬ìš©ì íˆìŠ¤í† ë¦¬(UserHistories)** í…Œì´ë¸”ì˜ ê²½ìš° í˜„ì¬ëŠ” **ì´ë¦„(`name`)ì»¬ëŸ¼**ì˜ ë³€ê²½ ë‚´ì—­ë§Œ ì €ì¥í•˜ê³  ìˆì§€ë§Œ, ì´í›„ **ì‚¬ìš©ìì˜ ëª¨ë“  ë³€ê²½ì‚¬í•­**, **API í˜¸ì¶œ ë‚´ì—­** ë“± ë‹¤ì–‘í•œ ì •ë³´ë¥¼ ì €ì¥í•˜ê²Œ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ´ ê²½ìš° í…Œì´ë¸”ì˜ **ì»¬ëŸ¼ì„ ìµœì†Œí™”**í•˜ì—¬ ë°ì´í„°ë¥¼ **íš¨ìœ¨ì ìœ¼ë¡œ** ì €ì¥ ë° í™œìš©í•  ìˆ˜ ìˆê²Œ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. 

ê·¸ë ‡ê¸° ë•Œë¬¸ì—, ì¼ë°˜ì ì¸ ë‹¤ë¥¸ í…Œì´ë¸”ê³¼ ê°™ì´ **`Integer` íƒ€ì…ì˜ ê¸°ë³¸í‚¤**ì™€ **`createdAt`**, **`updatedAt`**ê³¼ ê°™ì€ ì»¬ëŸ¼ì„ ì‚¬ìš©í•˜ëŠ”ê²ƒ ë³´ë‹¨, **UUID**ë¥¼ ì‚¬ìš©í•˜ì—¬ ì»¬ëŸ¼ì„ **ìµœì†Œí™”** í•˜ëŠ”ê²ƒì´ **ë¡œê·¸ í…Œì´ë¸”**ì—ì„œëŠ” ë”ìš± íš¨ìœ¨ì ì¸ ì„¤ê³„ê°€ ë  ê²ƒ ì…ë‹ˆë‹¤.

##### êµ¬í˜„
> ğŸ’¡ **[ê²Œì‹œíŒ í”„ë¡œì íŠ¸] ì‚¬ìš©ì ì´ë¦„ ë³€ê²½ API ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**  
1. ê²Œì‹œê¸€ì„ ì‘ì„±í•˜ë ¤ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì¸ì§€ ê²€ì¦í•©ë‹ˆë‹¤.  
2. ë³€ê²½í•  ì´ë¦„(`name`)ì„ **body**ë¡œ ì „ë‹¬ë°›ìŠµë‹ˆë‹¤.  
3. ì‚¬ìš©ìì˜ **í˜„ì¬ ì´ë¦„(**`name`**)**ì„ ì¡°íšŒí•©ë‹ˆë‹¤.  
4. **ì‚¬ìš©ì ì •ë³´ í…Œì´ë¸”(UserInofes)**ì˜ **ì‚¬ìš©ìì˜ ì´ë¦„(**`name`**)**ì„ ìˆ˜ì •í•©ë‹ˆë‹¤.  
5. ì‚¬ìš©ìì˜ ì´ë¦„ì´ ë³€ê²½ëœ ì´ë ¥ì„ **ì‚¬ìš©ì íˆìŠ¤í† ë¦¬(UserHistories)** í…Œì´ë¸”ì— ì €ì¥í•©ë‹ˆë‹¤.  
6. ì‚¬ìš©ì ì´ë¦„ ë³€ê²½ APIë¥¼ ì™„ë£Œí•©ë‹ˆë‹¤.

ì‚¬ìš©ì ì´ë¦„ ë³€ê²½ APIëŠ” 4ï¸âƒ£Â  ì‚¬ìš©ì ì •ë³´ì˜ ìˆ˜ì •ê³¼ 5ï¸âƒ£Â  ì‚¬ìš©ì íˆìŠ¤í† ë¦¬ ë°ì´í„° ì‚½ì…, 2ê°œì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ í•˜ë‚˜ì˜ ì‘ì—…ì²˜ëŸ¼ ì´ë£¨ì–´ì ¸ì•¼í•©ë‹ˆë‹¤.  
ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•˜ë˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê²Œ ëœë‹¤ë©´ ë°ì´í„°ì˜ ì¼ê´€ì„±ì´ ê¹¨ì§€ê²Œ ë  ê²ƒì´ê³ , ì‚¬ìš©ì íˆìŠ¤í† ë¦¬ í…Œì´ë¸”ì˜ ë°ì´í„°ë“¤ì„ ë¯¿ì„ ìˆ˜ ì—†ê²Œë˜ëŠ” ìƒí™©ì´ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.

ì´ì „ ì‚¬ì „ ì¤€ë¹„ ê³¼ì •ì„ ë°˜ì˜í•˜ê¸° ìœ„í•´ dbë¥¼ ë‹¤ì‹œ ìƒì„±í•©ë‹ˆë‹¤.

```bash
npx sequelize db:drop

npx sequelize db:create

npx sequelize db:migrate
```

ì½”ë“œ ì™„ì„±
```js
// ì‚¬ìš©ì ì´ë¦„ ë³€ê²½ API
router.put('/users/name', authMiddleWare, async(req, res) => {
  const {name} = req.body; // ë³€ê²½í•  ì´ë¦„
  const {userId} = res.locals.user;

  const userInfo = await UserInfos.findOne({where: {userId}});
  const beforeUserName = userInfo.name;

  // íŠ¸ëœì­ì…˜
  const t = await sequelize.transaction({
    isolationLevel: Transaction.ISOLATION_LEVELS.READ_COMMITTED,
  });

  try{
    // ì‚¬ìš©ì ì •ë³´ í…Œì´ë¸”ì— ìˆëŠ” ì´ë¦„ ë³€ê²½
    await UserInfos.update(
      { name },
      {
        where: { userId },
        transaction: t, // transactionì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
      }
    );

    // ë³€ê²½ëœ ì´ë¦„ ë‚´ì—­ì€ UserHistories í…Œì´ë¸”ì— ì‚½ì…
    await UserHistories.create(
      {
        UserId: userId,
        beforeName: beforeUserName,
        afterName: name,
      },
      { transaction: t } // transactionì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
    );
    await t.commit(); // ëª¨ë“  ë¡œì§ ì„±ê³µ ì‹œ DBì— ë°˜ì˜
  }catch(transactionError){
    console.error(transactionError);
    t.rollback();
    return res.status(400).json({errorMessage:"ìœ ì € ì´ë¦„ ë³€ê²½ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤."})
  }
  return res.status(200).json({message:"ìœ ì € ì´ë¦„ ë³€ê²½ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤."})
})
```
ì•„ë˜ ë¡œê·¸ì™€ ê°™ì´ ì¶œë ¥ë©ë‹ˆë‹¤.
```log
Executing (c03a9600-80df-4713-b8c3-2815a068755f): SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
Executing (c03a9600-80df-4713-b8c3-2815a068755f): START TRANSACTION;
Executing (c03a9600-80df-4713-b8c3-2815a068755f): UPDATE `UserInfos` SET `name`=?,`updatedAt`=? WHERE `userId` = ?
Executing (c03a9600-80df-4713-b8c3-2815a068755f): INSERT INTO `UserHistories` (`userHistoryId`,`UserId`,`beforeName`,`afterName`) VALUES (?,?,?,?);
Executing (c03a9600-80df-4713-b8c3-2815a068755f): COMMIT;
```