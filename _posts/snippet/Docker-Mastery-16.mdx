---
title:  "[Docker Mastery] - 16"
description:  "ì¿ ë²„ë„¤í‹°ìŠ¤ Network"
language:  "devops"
category:  "Docker"
update:  "2024-04-17"
hide:  false
serisenumber:  16
---

## ì‹œì‘

- [Maximilian SchwarzmÃ¼ller ë‹˜ì˜ Docker & Kubernetes : ì‹¤ì „ ê°€ì´ë“œ ê°•ì˜ë¥¼ ë“£ê³  ì‘ì„±í•œ ê¸€ì…ë‹ˆë‹¤.](https://www.udemy.com/course/docker-kubernetes-2022/?couponCode=KEEPLEARNING)

### êµ¬ì„±

ì—…ë¬´ ìƒì„± ë°±ì—”ë“œ ì„œë²„, ìœ ì € ê´€ë¦¬ ë°±ì—”ë“œ ì„œë²„, ì¸ì¦ ë°±ì—”ë“œ ì„œë²„ 3ê°€ì§€ ë„ë©”ì¸ìœ¼ë¡œ ë‚˜ë‰œ ë°±ì—”ë“œê°€ ìˆëŠ” í™˜ê²½ìœ¼ë¡œ êµ¬ì„±ëœ ë°°ê²½ì„ ë°”íƒ•ìœ¼ë¡œ ë‚´ìš©ì´ ì§„í–‰ë©ë‹ˆë‹¤.

ìœ ì €, ì¸ì¦ ì„œë²„ëŠ” í•œ íŒŒë“œë‚´ ê°ê°ì˜ ì»¨í…Œì´ë„ˆë¡œ ì‘ë™í•  ê²ƒì´ê³ , íŒŒë“œ ë‚´ë¶€ í†µì‹ ì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. ì—…ë¬´ ìƒì„± ì„œë²„ëŠ” ë³„ë„ì˜ íŒŒë“œë¡œ êµ¬ì„±ë˜ë©° ìœ ì € ì„œë²„, ì—…ë¬´ ìƒì„± ì„œë²„ëŠ” ì™¸ë¶€ì—ì„œ ì´ìš©í•  ìˆ˜ ìˆë„ë¡ ì„œë¹„ìŠ¤ì™€ ì—°ê²°í•©ë‹ˆë‹¤.

ê¶Œí•œì˜ ê²½ìš° ì™¸ë¶€ í†µì‹ ì€ í•˜ì§€ ì•Šê³  ìœ ì € API ì»¨í…Œì´ë„ˆì™€ ë™ì¼ íŒŒë“œë‚´ ë‚´ë¶€ í†µì‹ ì„ ì§„í–‰í•©ë‹ˆë‹¤.

`compose`ë¡œ êµ¬ì„±í•˜ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```yaml
version: "3"
services:
  auth:
    build: ./auth-api
  users:
    build: ./users-api
    ports: 
      - "8080:8080"
  tasks:
    build: ./tasks-api
    ports: 
      - "8000:8000"
    environment:
      TASKS_FOLDER: tasks
```

ì´ì œ ì´ êµ¬ì„±ì„ ì¿ ë²„ë„¤í‹°ìŠ¤ë¡œ ì˜®ê²¨ë´…ì‹œë‹¤.

### users deployment êµ¬ì„±

ìš°ì„  auth ë‚´ë¶€ í†µì‹ ì€ ì œì™¸í•œ ì±„ êµ¬ì„±í•©ë‹ˆë‹¤. ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  docker hubì— push í•©ë‹ˆë‹¤.

```yaml
# users-deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: users-deployment
spec:
  # Pod ì¸ìŠ¤í„´ìŠ¤ 1ê°œ
  replicas: 1
  selector:
    matchLabels:
      app: users
  template:
    metadata:
      labels:
        app: users
    spec:
      containers:
      - name: users
        image: wooglim/kub-demo-users
```

### users service êµ¬ì„±

PodëŠ” ì œê±°ë˜ê±°ë‚˜ ë‹¤ë¥¸ ì›Œì»¤ë…¸ë“œë¡œ ì˜®ê²¨ì§€ë©´ ê¸°ë³¸ IPê°€ ë³€ê²½ë©ë‹ˆë‹¤. ê³ ì •ì ì¸ IPë¥¼ ì§€ì›í•˜ì—¬ íŒŒë“œì™€ labelë¡œ ì—°ê²°ë˜ì–´ ì™¸ë¶€ë¡œ í†µì‹ í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” `service`ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.

```yaml
# users-service
apiVersion: v1
kind: Service
metadata:
  name: users-service
spec:
  selector:
    # íŒŒë“œ label ë§¤ì¹­
    app: users
  # ì‹¤í–‰ ë…¸ë“œ ê´€ê³„ ì—†ì´ ëª¨ë“  í¬íŠ¸ì— ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì—¬ëŸ¬ ë ˆí”Œë¦¬ì¹´ì— ë¶„ë°°
  type: LoadBalancer
  ports:
  - protocol: TCP
    # ì™¸ë¶€ ìš”ì²­ ë°›ëŠ” í¬íŠ¸
    port: 8080
    targetPort: 8080
```

êµ¬ì„±í•œ YAML í™˜ê²½ì„ ì ìš©í•©ë‹ˆë‹¤.

```bash
kubectl apply -f=users-deployment.yaml -f=users-service.yaml
minikube service users-service

ğŸƒ  Starting tunnel for service users-service.
|-----------|---------------|-------------|------------------------|
| NAMESPACE |     NAME      | TARGET PORT |          URL           |
|-----------|---------------|-------------|------------------------|
| default   | users-service |             | http://127.0.0.1:50601 |
|-----------|---------------|-------------|------------------------|
```

ì´í›„ users API ì¸ ë¡œê·¸ì¸, íšŒì›ê°€ì… ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆê² ì§€ë§Œ ì•„ì§ ë”ë¯¸ë¡œë§Œ ì‘ë™í•  ë¿, auth APIì™€ íŒŒë“œë‚´ ë‚´ë¶€ í†µì‹ ì´ ê°€ëŠ¥í•˜ë„ë¡ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.

docker-compose ì˜ ê²½ìš° ì„œë¹„ìŠ¤ ëª…ìœ¼ë¡œ ê°™ì€ ë„¤íŠ¸ì›Œí¬ì— í¬í•¨ëœ ì»¨í…Œì´ë„ˆë¼ë©´ ì´ë¦„ìœ¼ë¡œ ì¹˜í™˜ì´ ê°€ëŠ¥í–ˆì§€ë§Œ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ê²½ìš° ë‹¤ë¦…ë‹ˆë‹¤. ì‹¤í–‰ì¤‘ì¸ í™˜ê²½ì— ë”°ë¼ ìœ ë™ì ì…ë‹ˆë‹¤.

ê¸°ì¡´ users api ì„œë²„ ì½”ë“œë¥¼ ìˆ˜ì • í•˜ê³  ë³€ê²½ì‚¬í•­ì„ í—ˆë¸Œì— push í•©ë‹ˆë‹¤.

```js
// users signup api
// const hashedPW = await axios.get('http://auth/hashed-password/' + password);
const hashedPW = await axios.get(`http://${process.env.AUTH_ADDRESS}/hashed-password/` + password);
```

ì´ì–´ì„œ auth api ë°±ì—”ë“œ ì„œë²„ë¥¼ ì´ë¯¸ì§€ ë¹Œë“œ í›„ ë„ì»¤ í—ˆë¸Œì— push í•©ë‹ˆë‹¤.

ë™ì¼ íŒŒë“œë‚´ ì¡´ì¬í•´ì•¼í•˜ë¯€ë¡œ ê¸°ì¡´ `users-deployment.yaml`ì— ì¶”ê°€ ì»¨í…Œì´ë„ˆë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. auth apiì˜ ê²½ìš° íŒŒë“œë‚´ í†µì‹ ë§Œ ì§€ì›í•  ê²ƒì´ë¯€ë¡œ `service`ë¥¼ ë³„ë„ë¡œ ì„¤ì •í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### ë‚´ë¶€ í†µì‹  ì„¤ì •í•˜ê¸°

users APIì—ì„œ auth APIë¥¼ ë‚´ë¶€ì—ì„œ ìš”ì²­í•  ìˆ˜ ìˆë„ë¡ ë°˜ì˜í•´ë´…ì‹œë‹¤.

ë‹¤ì‹œ deployment yaml íŒŒì¼ì„ ìˆ˜ì •í•©ë‹ˆë‹¤.
```yaml
# users-deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: users-deployment
spec:
  # Pod ì¸ìŠ¤í„´ìŠ¤ 1ê°œ
  replicas: 1
  selector:
    matchLabels:
      app: users
  template:
    metadata:
      labels:
        app: users
    spec:
      containers:
      - name: users
        image: wooglim/kub-demo-users:latest
        env:
        - name: AUTH_ADDRESS
          # ë™ì¼ íŒŒë“œì—ì„œ ì‘ë™í•˜ë¯€ë¡œ localhost ë¥¼ ì´ìš©í•´ authì™€ ì—°ê²° authëŠ” 80í¬íŠ¸ë¡œ ì„œë²„ ì‹¤í–‰í•˜ë¯€ë¡œ ìƒëµ.
          value: localhost
      - name: auth
        image: wooglim/kub-demo-auth:latest
```

```bash
> kubectl apply -f=users-deployment.yaml
deployment.apps/users-deployment configured

> kubectl get pods
NAME                                READY   STATUS        RESTARTS   AGE
users-deployment-655d9785dd-gvwxs   2/2     Running       0          29s
users-deployment-88c9f4b57-nw57w    1/1     Terminating   0          25m
```

deplyoment ì„¤ì •ì„ ë³€ê²½í•˜ì—¬ ë‚´ë¶€ í†µì‹ ì´ ê°€ëŠ¥í•˜ë„ë¡ ë³€ê²½ë©ë‹ˆë‹¤.

![volume-error-get](/snippets/kube/chap3/in-communication-pods.png)